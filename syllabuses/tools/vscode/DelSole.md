### Del Sole Al., Visual Studio Code Distilled
<https://www.apress.com/gp/book/9781484242230>

---

- кроссплатформенная, базируется на Electron
- поддердивает инструменты для всего цикла разработки: написания кода, отладки, взаимодействия команд и всего прочего
- а также для всех типов приложений: мобильных, облачных, веб, и прочих

Многие вещи в книге не разобраны (или разобраны поверхностно), так что часто это не просто конспект, а с добавлением более детальной информации.

#### Введение
- работает с отдельными файлами или папкам
- интегрируется с другими тулзами через систему *тасков*
- не имеет визуальных конструкторов, является системой общего назначения, так что может быть не лучшим выбором для специфических задач (напр., разработки десктопных Windows-приложений). Там может лучше подойти Visual Studio
- описание установки
- локализация: команда `Configure Display Language` + установка расширения из категории `@category:"language packs"`. Пишет что настройки хранятся в неком файле `locale.json`, но я его не нашел
- обновления управляются опцией `update.mode` (по дефолту включено автоматическое обновление). В той же секции настроек (`Application > Update`) есть опция показа Release Notes
- билды Insiders дают все новые фичи раньше

#### Знакомство с окружением
- страница приветствия (Welcome page) содержит группы полезных ссылок. И чексбокс прямо на ней, позволяющий скрывать
- редактор занимает центральную часть. Файл можно разделить через кнопку "Split editor" (`Ctrl + \`) или открыть из списка слева при помощи "Open to the side" (`Ctrl + click`). Изменения во всех одновременно открытых редакторах одного и того же файла отображаются в реальном времени. Переключения между табами: `Ctrl + Tab`
- вкладки редакторов можно перетаскивать, изменять размеры редакторов мышкой, команды `View > Zoom in/out` (`Ctrl + +/-`) меняют масштаб
- строка состояния (status bar):
  * информация Git (текущая ветка и прочее)
  * ошибки и предупреждения в коде
  * слева --/-- справа - только если есть открытый редактор
  * текущая строка/столбец
  * информация об отступе (кол-во пробелов)
  * кодировка
  * символ завершения строки
  * выбранный для файла язык программирования
  * проект (?), кнопка фидбека (у меня скрыта) и значок нотификаций (как правило, от расширений)
- цвета status bar: фиолетовый - если открыт одиночный файл, синий - если открыта папка, и оранжевый - когда запущен дебаггер
- панель действий (activity bar) - можно считать ее "сжатой" боковой панелью. Содержит иконки для: Explorer, Search, VCS, Run/Debug, Extensions, и Settings внизу. Первый клик по иконке переключает на нужный вариант, последующие сворачивают/разворачивают боковую панель
- боковая панель (side bar) - одна из важнейших частей среды. У каждого типа, если кликнуть правой клавишей мыши на заголовке, можно скрывать/показывать внутренние панели, напр., "Open editors"/"Outline" у "Explorer". Всю боковую панель можно переместить вправо
- ("Open editors" и "Outline" у меня отключены, т.к. первый дублируется табами, а второй breadcrumb-ами)
- список пяти типов. Хоткеи - `Ctrl + Shift + <Key>`:
  * Explorer (`E`) - панели "Open editors" и "Outline", панель с названием текущей открытой папки. При наведении курсора на заголовок панели появятся кнопки "New File", "New Folder", "Refresh", и "Collapse All". В панели "Outline" (как и в breadcrumb-ах) можно фильтровать элементы, просто начав печатать
  * Search (`F`) - поиск и замена в файлах. Можно переместить в панель под редактором (через контекстное меню), можно открыть поиск в центральной области редактора (через кнопку в заголовке панели). Результаты поиска отображаются иерархически. Есть кнопки "Replace all", поля "Files to include/exclude". Поиск и замену можно вести с учетом регистра или без, по регулярному выражению
  * Source Control (`G`) - поле с текстом для коммита, кнопки "Refresh"/"Commit"/"Toggle view mode", и кнопка "..." с парой десятков команд Git
  * Run (`D`) - кнопки создания/выбора конфигурации, открытия debug-панели под редактором, внутренние панели "Variables"/"Watch"/"Call stack"/"Breakpoints"
  * Extensions (`X`) - поле поиска, кнопки очистки и "..." - выбора категории. Названия внутренних панелей соответствуют категориям языка поиска (`@<category>`)
  * + Manage - при клике показывает меню, аналогичное тому что в `File > Preferences`: настройки, темы, горячие клавиши, сниппеты
- палитра команд (command palette) - очень важный элемент. Открывается через `View > Command palette` или `Ctrl + Shift + P`. Список фильтруется при вводе, горячие клавиши команд показываются прямо в списке
- область панелей (panels area) отображает вывод разных инструментов (Git-а, дебаггера, внешних тулзов). Располагается по умолчанию внизу, но можно переместить влево/вправо. Панель можно максимизировать (кнопка рядом с "Закрыть"), тогда она займет всю область редактора. Открываются через `View > <type>`
- список четырех панелей:
  * Problems (`Ctrl + Shift + M`) - список тех проблем, которые подчеркиваются волнистой линией в коде (красной для ошибок, зеленой для предупреждений - в панели это будут разные иконки; только для языков, поддерживающих детект ошибок). Есть поле фильтра и кнопка "Collapse all". Проблемы группируются по именам файлов
  * Output (`Ctrl + K H`) - вывод от внутренних и внешних тулзов. Есть выпадающий список с источниками вывода, кнопки очистки и включения/выключения автоскроллинга. Для логов есть кнопка открытия файла в редаторе
  * Debug (`Ctrl + Shift + I`) - обычно пустая, в режиме отладки содержит информацию о дебаг-сессии. Внизу панели строка для ввода команд
  * Terminal (``Ctrl + ` ``). Выпадающий список доступных терминалов, кнопки добавления/удаления/вертикального разделения. Эта панель будет открываться автоматически: VSCode через терминал запускает скрипты/таски

#### Поддержка языков и фичи редактора
- поддержка многих языков идет из коробки. Остальные могут быть загружены с маркетплейса, в виде расширений. Расширения также часто дают более широкую поддержку языка, чем идет по умолчанию
- в меню `Edit` идут все стандартные команды (`Copy`/`Paste`/`Undo`/`Redo`/`Find`/`Replace`etc.), а также `Toggle line comment` (`Ctrl + /`) и `Toggle block comment` (`Ctrl + Shift + A`). Пункты "Emmet..." рассматриваются ниже
- меню "Selection":
  * стандартное `Ctrl + A` и `Shrink / Expand selection` (`Alt + Shift + Left/Right`) - сужение/расширение текущего выделения, посимвольно/поблочно
  * перемещение текущей строки - `Alt + Up/Down`. Для копирования нужно дополнительно зажимать `Ctrl + Shift`
  * есть команда `Duplicate selection` (без хоткея) копирует/вставляет сбоку то, что сейчас выделено
  * `Select all oocurences` (`Ctrl + Shift + L`) выделяет в документе всё, что совпадает с текущим выделением
  * `Add next occurence` (`Ctrl + D`) делает то же последовательно, только уже учитывает границы слов. Очень удобна для быстрого выделения слова под курсором
  * вообще, добавление мультикурсора идет по `Alt + click`. В меню есть команда сменить `Alt` на `Ctrl`
  * хоткеи для добавления мультикурсора в позицию над/под текущим - `Alt + Shift + Up/Down`, но работает и с `Ctrl` вместо `Alt`
  * `Alt + Shift + I` задает мультикурсор в конце каждой строки выделенного блока (без блочного выделения не делает ничего). `Home/End` после этого перемещает мультикурсор в начало строки и обратно
  * в меню есть флажок - `Column selection mode`, при его включении выделение мышкой идет по столбцам, не по строкам. Тот же эффект достигается если при выделении мышкой зажать `Shift + Alt`
- сворачивание (folding) блоков кода - визуально, кликая иконки рядом с номерами строк, или `Ctrl + Shift + ]/[`. Номера строк при этом учитывают фолдинг, идут с разрывами
- сниппеты могут быть как для конкретного языка, так и для проекта, и  глобальные(`.json`-файлы с суффиксом `.code-snippets`):
  * используют синтаксис TextMate
  * команда `User snippets` или одноименный пункт в меню `File > Preferences` показывает диалог выбора языка, после чего открывает файл в папке `~/.config/Code/User/snippets/<lang-name>.json`. В том же диалоге можно выбрать глобальные сниппеты или для текущей папки
  * где в формате `"<snippet-name>": { "prefix": [...], "body": [...], "description": "..." }` задается собственно сниппет. Плейсхолдеры в `body`: `$0`/`${1 :<text>}`
  * подробное описание синтаксиса и привязки горячих клавиш к сниппетам: <https://code.visualstudio.com/docs/editor/userdefinedsnippets>
- Emmet - многоуровневые сниппеты с wildcard-ами:
  * описываются в файле `snippets.json` в папке `emmet.extensionsPath`
  * формат: `"<lang>": { "snippets": { "<prefix>": "ul>li[id=${1} class=${2}]*2{...}" } }`
  * подробно: <https://code.visualstudio.com/docs/editor/emmet>
- помимо сниппетов и Emmet-а есть и автодолнение ключевых слов, из коробки. `Enter`/`Tab` вставят выбранное из списка
- мини-карта файла (minimap) включается в меню `View > Show minimap`
- в том же меню `View` есть опции `Render whitespaces` (отображать точки для пробелов), `Show breadcrumbs`
- предпросмотр markdown-файлов открывается по `Ctrl + K V` сбоку, и по `Ctrl + Shift + V` - просто в другой вкладке
- IntelliSense вызывается, когда печатаешь, или по `Ctrl + Space`. Вставка по `Enter`/`Tab`. Для CamelCase-нотаций можно вводить заглавные буквы, поиск будет это учитывать. Показ документации по наведению курсора
- `Go to definition` работает через контекстное меню и `Ctrl + click`
- `Find all references` покажет окно-врезку с количеством вхождений и списком ссылок в правой части
- `Peek definition` тоже показывает такое окно-врезку, позволяя редактировать объявления без перехода
- переименования: `F2`/`Ctrl + F2`
- для многих языков идет анализ кода в реальном времени. Проблемы подчеркиваются волнистыми линиями и отображаются в панели "Problems". Появляющаяся иконка в виде желтой лампочки - это инструмент Light Bulb. При клике на иконку показывается список возможных фиксов, напр., разные методы рефакторинга

#### Работа с файлами и папками
- VSCode является каталого-ориентированной системой, на проекто-ориентированной. Можно открывать папки целиком, не только отдельные файлы
- при открытии папки VSCode ищет файлы проектов, такие как `Tsconfig.json`/`Jsconfig.json`/`Package.json`/`Project.json`/`*.sln`, и отображает папку в соответствии с
- `Ctrl + O` открывает файл, `Ctrl + N` создает, `Ctrl + Tab` переключается между. При открытии файла автоматически детектится язык программирования (как?), но можно выбрать и вручную (`Select Language Mode` в правом нижнем углу или палитре команд). В том же углу можно менять кодировку и символ перевода строки
- несколько папок можно организовать в workspace, открывать их одновременно, задавать общие для них свойства. В json-файле, описывающем workspace, есть ключ `"folders": [ { "path": "..." }, {...}, ... ]`

#### Кастомизация
- выбор цветовой темы - `Preferences > Color theme`
- страница настроек, строка поиска, файл с перекрывающими пользовательскими настройками - `~/.config/Code/User/settings.json`. Уровни: глобальный, пользовательский, workspace/папка
- `Preferences > Keyboard shortcuts`, строка поиска, файл с перекрывающими пользовательскими настройками - `~/.config/Code/User/keybindings.json`, возможность задания своих через интерфейс, условия `when`

#### Расширения
- маркетплейс: <https://marketplace.visualstudio.com>, или из VSCode, "Install" -> "Reload" -> "Disable"/"Uninstall"
- рекомендованные расширения, всплывающие предложения об установке таких расширений
- настройки расширений встраиваются в общую страницу
- расширения как правило пишутся на TypeScript с использованием Yeoman (генератор поверх Node.js). Для публикации на маркетплейсе нужно иметь аккаунт MIcrosoft

#### Управление версиями с Git
- через расширения поддерживаются и другие VCS, напр., SVN
- через интерфейс VSCode можно инициализировать репозиторий, а вот подключать remote-ы нужно через терминал
- свой визуальный diff, с красно-зелеными блоками
- многие операции можно выполнять через меню "..." (или палитру команд), внутренние панели на вкладке "Source control" будут группировать файлы (напр., "Changes", "Staged")
- ветка отображается в левом нижнем углу, клик на ней вызовет меню с возможными действиями
- в панели "Output" отображаются все выполняемые команды
- расширения для Git:
  * Git History показывают историю коммитов, позволяет создавать ветку от предыдущих коммитов
  * GitLens - много функциональности, напр., аннотирование файлов, история коммитов
  * GitHub PullRequests - собственно, запросы на включение
- описание совместной облачной разработки с расширением Azure DevOps

#### Автоматизация, таски
- интеграция VSCode с внешней тулзой называется *таском* (task). Как правило, это набор инструкций и настроек в файле `tasks.json`
- таски делятся по типам, наиболее попуярные это build (компиляция), test (юнит-тесты), watch (слежение за изменениями в файлах и перекомпиляция по необходимости)
- действия по таскам (`Run`/`Configure`/`Terminate`/etc.) находятся в меню `Terminal`. `Run task` выдаст список доступных
- т.н. `Default build task` запускается по `Ctrl + Shift + B`
- VSCode может автоматически детектить таски в текущей папке. Например, для тасков Node.js
- ключи в `tasks.json`: `"label"`, `"type"`, `"command"`, `"args"`, `"group"`, `"isDefault"` и другие
- объект-опция `"presentation"` описывает поведение терминала при запуске таска (ключи `"echo"`, `"reveal"`, `"focus"`, etc.)
- в json-е можно использовать переменные, такие как `${workspaceFolder}`, `${file}`, `${env.VARIABLENAME}` и другие
- секции `"windows"`/`"linux"`/`"osx"` задают системо-специфические настройки
- при конфигурировании (создании) таска можно выбирать не "Other" (пустую заготовку), а готовый шаблон таска (напр., MSBuild или Maven)
- варианты запуска со сканированием вывода таска или без. Вывод сканируется т.н. problem matcher-ом. Они есть готовые, или можно создать самому (поле `"problemMatcher"`), через регулярные выражения
- команда `Terminal > Run active file` запустит текущий файл в дефолтной программе для такого типа

#### Запуск и дебаг
- меню `Run`, команды `Start debugging` (`F5`) и `Run without debugging` (`Ctrl + F5`)
- зеленая кнопка на вкладке Debug боковой панели также запускает дебаг. Рядом с этой кнопкой виджет управления конфигурациями отладки и кнопка открытия debug-консоли
- конфигурации отладки хранятся в файле `launch.json`, в массиве `"configurations"`. Ключи: `"name"` - название, `"type"` - тип дебаггера, `"request" = launch|attach`, `"program"` - бинарник, который нужно дебажить, `"preLaunchTask"`, `"launchBrowser"`, `"env"` и другие
- добавление/удаление breakpoint-а - клик в области с номерами строк или `F9`. Можно добавлять и другие типы breakpoint-ов, напр., по имени функции (удобно, когда код недоступен). Внутренняя панель Breakpoints во вкладке Debug хранит список
- вся информация об отладке выводится в панель Debug, внутренние же панели вкладки Debug позволяют просматривать состояние переменных, стека, вычислять выражения (watch)
- панелька сверху (Debug action pane) содержит действия: `Step Into/Out/Over`, `Continue/Stop/Restart`
- при наведении курсора на переменную в коде всплывет окошко с состоянием переменных (содержимое подпанели "Variables" в "Debug")
- в панели "Debug" (внизу) можно вводить и выполнять команды отладчика, вычислять значения переменных и т.д.
