### Korbel F., FFmpeg Basics
<http://ffmpeg.tv>

---

- книга посвящена работе с бинарниками FFMpeg-а, не с библиотеками и исходным кодом
- вырвиглазный сайт книги: <http://ffmpeg.tv>
- утилиты командной строки (4):
  * `ffmpeg` - кодер/декодер
  * `ffplay` - плеер
  * `ffprobe` - показывает характеристики медиа-файлов
  * `ffserver` - сервер для стриминга
- библиотеки (9):
  * `libavcodec` - кодеки
  * `libavdevice` - устройства
  * `libavfilter` - фильтры
  * `libavformat` - контейнеры
  * `libavutil` - утиллиты
  * `libpostproc` - пост-процессинг (?)
  * `libswresample` - ре-семплинг для аудио (?)
  * `libswscale` - масштабирование
- написан на Си, полностью кроссплатформенный
- всё так же пользуются мейл-листами
- формат: `$ ffmpeg [global options] [input file options] -i input_file [output file options] output_file`
- вместо такой записи можно просто тестировать результат, без записи в файл: `$ ffplay -i input_file ... test_options`
- входов/выходов может несколько, и они могут быть не только файлами, но и потоками, перенаправлениями, устройствами, и т.д.
- процесс: чтение из входов --> демуксер (распаковка контейнера) --> кодированные пакеты данных --> декодирование пакетов --> несжатые фреймы --> (опциональные) фильтры --> кодирование пакетов --> кодированные пакеты данных --> муксер (упаковка в контейнеры) --> запись в выходы
- фильтры организуются в цепочки и графы, и имеют своё API (библиотека `libavfilter`). Их можно использовать просто указывая в командной строке, с опциями `-af`/`-vf` (аудио/видео фильтры). Можно параметризовать фильтры прямо из командной строки
- контейнеры типа mkv/avi/mp4 поддерживают *потоки*. FFMpeg распознает 5 типов потоков: audio (a), attachment (t), data (d), subtitle (s), video (v)
- описания опций (цепочек) фильтров и выбора потоков пропускаем
- помощь:
  * общая: `$ ffmpeg -?`/`$ ffmpeg -h`
  * немного больше: `ffmpeg -h long`/`$ ffmpeg -h full`
  * по темам: `$ ffmpeg -? topic`/`$ ffmpeg -h topic`
  * по компонентам: `$ ffmpeg -h (decoder|encoder|demuxer|muser)=<name>` (напр., `$ ffmpeg -h decoder=flv`)
- списки доступных (`$ ffmpeg -<option>`): битовых потоков - `bsfs`, кодеков - `codecs`, декодеров: `decoders`, (эн)кодеров: `encoders`, фильтров - `filters`, форматов - `formats`, положений аудиоканалов (право/лево/...) - `layouts`, пиксельных форматов (?) - `pix_fmts`, протоколов (файловых и сетевых) - `protocols`, форматов аудио-семплирования (?) - `sample_fmts`
- лицензия - `$ ffmpeg -L`, версия - `$ ffmpeg -version`

---

- описание того, что такое фреймрейт (частота кадров) / битрейт (кол-во битов, обрабатываемых в единицу времени)
- изменение размеров / масштабирование видео. Теорема Найквиста
- обрезка / добавление полей
- повороты / отражение по осям
- размытие / резкость / управление шумом
- картинка в картинке (оверлей), напр., логотипы в углу
- добавление текста
- конвертация из одного формата в другой
- обрезка по времени, задержки, скорость воспроизведения, синхронизация
- в опциях можно использовать математические функции, операторы и константы
- работа с метаданными (автор, название альбома, дата публикации и т.д.) и субтитрами (внешними и встроенными)
- скриншоты, нарезка видео на фреймы, gif-ки. FFMpeg может работать и как простой редактор картинок (изменение размеров, повороты, смена типа и т.д.). Можно и видео из картинок создавать
- цифровое (дискретное) аудио
- пресеты - файлы, содержащие списки опций. Использование: `$ ffmpeg ... -fpre <file-name> ...`
- черезстрочная развертка ((de)interlacing), форматы PAL/SECAM/NTSC
- краткий обзор 4 cli-утилит и 9 библиотек. Перечисление проектов, использующих FFMpeg, медиа-фреймворков и плееров
- через спец. девайс (`$ ... -f dshow ...`) можно работать с микрофоном и вебкой
- батч-файлы (раздел про скриптинг). Создание мелодии "Джингл Беллз" скриптом
- изменение цветов фильтрами, в том числе приведение к черно-белому. Коррекции яркости, насыщенности и контраста
- слияние нескольких аудио- или видеофайлов
- удаление логотипа (фильтр `delogo`), удаление тряски видео (фильтр `deshake`), добавление прямоугольника - детектора движения (так ли? фильтр `drawbox`), проверка наличия черных участков видео (`blackdetect`/`blackframe`), удаление (фильтрация) фреймов из аудио/видео (`select`), захват экрана (устройство `$ ... -f dshow ...`), подробная информация о файле (`showinfo`), эквалайзер (`showspectrum`/`showwaves`), синтез речи (через псевдофайл-источник `flite` и внешнюю библиотеку `libflite`), множественные аудио-источники (`amovie`/`movie`)
- зачем-то описание HTML5-тегов `<audio>`/`<video>`, сайтов с видео и монетизации
- отладка: опции `-debug[_ts]`, `-err_detect`, `-v`/`-loglevelv`. Фильтры для тестирования файлов: `asettb`/`settb`/`mptestsrc`. Настроечные таблицы - псевдоисточники данных `rgbtestsrc`/`testsrc`. Дамп пакетов - `-hex`. Расход памяти и загрузка процессора: `-benchmark[_all]`

- интересный глоссарий, с хорошим описанием разных понятий
